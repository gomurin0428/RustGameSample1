# history

- 2025-09-25 16:27:21 wasm-game のビルドエラーを解消。`resolve_canvas` と `canvas_2d_context` の戻り値を修正し、アニメーションループでの `Rc` の借用エラーを解消、`set_fill_style_str` を利用するよう更新。`cargo build` と `cargo test` を実行して成功を確認。
- 2025-09-26 08:45:29 jinja-game を新規実装。Rust + WebAssembly で神社ゴールの 2D アクションを構築し、`Cargo.toml`・`src/lib.rs`・`index.html`・`README.md` を整備。`cargo build --target wasm32-unknown-unknown` でビルド成功を確認。
- 2025-09-26 08:53:59 jinja-game を trunk 対応に変更。`index.html` に `data-trunk` リンクを追加し、`README.md` を trunk serve 手順へ更新。`trunk build` でビルド成功を確認し、TROUBLESHOOTING.md を trunk 前提の内容に整理。
- 2025-09-26 09:29:12 orstudy-game1 を新規構築。待ち行列理論学習用のシミュレーションを Rust + WebAssembly で実装し、到着率・サービス率・窓口数などの UI コントロールとリアルタイムメトリクス表示を追加。`cargo test` と `cargo build --target wasm32-unknown-unknown` をフルパスの `cargo.exe` で実行して成功を確認し、TROUBLESHOOTING.md に非 wasm テスト時の注意点を追記。
- 2025-09-26 09:53:23 realgeopolitics を新規構築。`config/countries.json` を読み込む Rust CLI 版ジオポリティクスシミュレーターを実装し、インフラ投資・軍事演習・外交ミッションなどの行動ループとランダムイベントを追加。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` / `test` / `build` を実行して成功を確認。
- 2025-09-26 10:12:49 realgeopolitics をワークスペース化し、`realgeopolitics-core` に共通ロジックを切り出して CLI (`realgeopolitics-cli`) を移行。さらに `realgeopolitics-web` と Yew/Trunk ベースの GUI を追加し、`cargo test --workspace --exclude realgeopolitics-web` と `cargo build -p realgeopolitics-web --target wasm32-unknown-unknown` の成功を確認。
- 2025-09-26 10:35:54 realgeopolitics をリアルタイム制に刷新。`realgeopolitics-core` に予算配分ベースの tick ループを追加し、CLI の `set`/`tick` コマンドと Web GUI のスライダー＋自動更新ループで即時反映するよう変更。`cargo test --workspace --exclude realgeopolitics-web` と `cargo build -p realgeopolitics-web --target wasm32-unknown-unknown` を再実行し成功を確認。
- 2025-09-26 10:43:22 GeoPolitical Simulator 化に向けた改修計画 `realgeopolitics/GEO_SIM_ROADMAP.md` を作成し、基盤強化・外交軍事・経済内政・UX までのフェーズ別ロードマップを整理。
- 2025-09-26 10:50:41 フェーズ1対応として `GameClock`・`CalendarDate`・`Scheduler` を実装し、`GameState` を多層カレンダーとタスクスケジューラ対応に改修。テスト (`cargo test --workspace --exclude realgeopolitics-web`) と wasm ビルド (`cargo build -p realgeopolitics-web --target wasm32-unknown-unknown`) を再度実行して成功を確認。
- 2025-09-26 11:04:35 スケジューラ実装に対応するユニットテストを追加し、`ScheduledTask::execute` の各タスク種別と `Scheduler` の動作を検証。再度 `cargo test --workspace --exclude realgeopolitics-web` と `cargo build -p realgeopolitics-web --target wasm32-unknown-unknown` を実行して成功を確認。
- 2025-09-26 11:13:59 スケジューラの優先度管理を拡張し、長期タスクをバケット圧縮する `Scheduler` ロジックと対応テストを追加。`cargo test --workspace --exclude realgeopolitics-web` と `cargo build -p realgeopolitics-web --target wasm32-unknown-unknown` を再実行して成功を確認。
- 2025-09-26 11:20:21 スケジューラに `ScheduleSpec` を導入し、繰り返しタスクの再登録とバケット昇格をユニットテスト付きで実装。`cargo test --workspace --exclude realgeopolitics-web` および `cargo build -p realgeopolitics-web --target wasm32-unknown-unknown` を再実行し成功を確認。
- 2025-09-26 11:44:08 realgeopolitics フェーズ1 UI連携を実装。core に TimeStatus を追加し、Web GUI で日付・次イベント表示と時間倍率セレクタ (低速/標準/高速/超高速/カスタム) を提供、速度オプションのユニットテストと TROUBLESHOOTING 更新を実施。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` を実行し成功を確認。
- 2025-09-26 12:09:26 realgeopolitics に FiscalAccount を実装し、収入・支出・債務・信用格付けを管理。CLI/GUI で予算残高と tick 別収支を表示し、利払い計上とユニットテスト (`fiscal_account_records_flows`, `fiscal_snapshot_updates_after_tick`) を追加。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` を実行し成功を確認。
- 2025-09-26 12:20:29 realgeopolitics 税制モジュールを実装し、TaxPolicy/TAX収支感応を導入。遅延計上と資源収益を FiscalAccount に反映し、CLI/GUI に税制列を追加。新テスト (`tax_policy_deferred_revenue_accrues`) を追加し、`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` を実行して成功を確認。
- 2025-09-26 13:21:34 realgeopolitics の予算配分を GDP 比率ベースへ刷新し、`BudgetAllocation`/`GameState` の最低支出ロジックを再設計。CLI `set` と Web NumericUpDown を 7 区分＋コア維持フラグ対応に統一し、UI/ドキュメント/TROUBLESHOOTING を更新。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` を実行して成功を確認。
- 2025-09-26 13:29:58 realgeopolitics-web のコア支出トグルが wasm ビルドで失敗していた型不整合を修正。`render_core_toggle` を `Event` ベースに見直し、wasm-bindgen-test で検知するユニットテストを追加。`C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` に加えて `cargo test --target wasm32-unknown-unknown -p realgeopolitics-web --no-run` と `wasm-bindgen-test-runner` 実行で結果を確認。
- 2025-09-26 13:45:08 realgeopolitics-core の `game` ロジックを `economy` / `country` / `market` / `state` の各モジュールへ分割し、`CountryState::new` を追加して初期化手順を整理。`mod.rs` で再エクスポートを整え、`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test -p realgeopolitics-core` の成功で構成とテストを確認。
- 2025-09-26 13:57:01 `realgeopolitics-core` の公開APIを整理し、`game` モジュール下の再エクスポートを `GameState` など7種類に限定。`CommodityMarket` や `FiscalAccount` は内部専用とし、TROUBLESHOOTING.md に新しいインポート方針を追記後、`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test` を成功させて確認。
- 2025-09-26 14:22:47 GameState の肥大化を解消するため `game::systems` に fiscal / policy / diplomacy / events / tasks を新設し、`GameState` はサブシステム調停に専念する構造へ再編。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test` を実行し、疎結合化後もビルドとテストが通ることを確認。
- 2025-09-26 14:36:09 `FiscalAccount::update_fiscal_cycle` を実装して利払い・償還・新規起債・危機判定を自動化し、`game::systems::policy` から呼び出すフローを追加。新規テスト `update_fiscal_cycle_*` を含む `C:\Users\gomur\.cargo\bin\cargo.exe fmt` / `C:\Users\gomur\.cargo\bin\cargo.exe test` / `cargo.exe test --workspace` を成功させ、GEO_SIM_ROADMAP.md の債務 Dynamics を完了状態に更新。
- 2025-09-26 14:50:03 realgeopolitics にカバレッジ自動生成コマンドを追加。.cargo/config.toml で cargo coverage エイリアスを定義し、coverage.ps1 から HTML/LCOV レポート (coverage/html/index.html, coverage/lcov.info) を生成できることを確認し、実行結果で全テストが成功することも合わせて確認。
- 2025-09-26 15:09:38 realgeopolitics の財政レポート機能を実装。`FiscalSnapshot`/`FiscalTrendPoint` を core に追加して履歴を蓄積し、`GameState::fiscal_snapshots`・`fiscal_snapshot_of` を公開。Web UI では折れ線チャートと財政サマリを描画し、GEO_SIM_ROADMAP.md と TROUBLESHOOTING.md を更新。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` → `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` → `C:\Users\gomur\.cargo\bin\cargo.exe build -p realgeopolitics-web --target wasm32-unknown-unknown` を実行して成功を確認。
- 2025-09-26 15:32:35 realgeopolitics のイベントテンプレート基盤を構築。`config/events` の YAML/JSON をビルド時に読み込み、条件式パーサと `ScriptedEvent` タスクで債務危機/資源ブームイベントを発火できるようにした。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` → `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` → `C:\Users\gomur\.cargo\bin\cargo.exe build -p realgeopolitics-web --target wasm32-unknown-unknown` を実行して動作確認済み。
- 2025-09-26 15:42:49 realgeopolitics のダッシュボード機能を実装。`FiscalSnapshot`/`FiscalTrendPoint` に GDP・債務比率などを追加し、Web UI でカード表示と直近 12 tick の債務比率チャートを描画。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` → `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` → `C:\Users\gomur\.cargo\bin\cargo.exe build -p realgeopolitics-web --target wasm32-unknown-unknown` を実行して正常動作を確認。
- 2025-09-26 16:01:51 realgeopolitics Web UI のタブ構成を再設計。操作系・指標ダッシュボード・外交/イベントを三分割タブ化し、ダッシュボード内に債務比率と財政レポートの切替タブを追加。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` → `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` → `C:\Users\gomur\.cargo\bin\cargo.exe build -p realgeopolitics-web --target wasm32-unknown-unknown` を実行し表示崩れが無いことを確認。
- 2025-09-26 16:21:42 一次〜三次産業およびエネルギーセクター拡張の仕様と導入計画を GEO_SIM_ROADMAP.md に追加し、データ構造・依存関係・政策 UI までの段階的実装ステップを整理。
- 2025-09-26 16:31:55 `core::game::economy::industry` モジュールと `config/industries/*.yaml` を新設。セクター/依存関係/カタログ読み込みのデータ構造を定義し、`cargo fmt` → `cargo test --workspace` を実行して正常終了を確認。
- 2025-09-26 17:41:24 realgeopolitics-core の産業依存テストを安定化。入力不足検証は専用カタログを構築して再現性を確保し、エネルギー不足はコスト増を確認する形に更新。`C:\\Users\\gomur\\.cargo\\bin\\cargo.exe test -p realgeopolitics-core` と `pwsh ./coverage.ps1` を実行して全テスト成功とカバレッジ生成を確認。
- 2025-09-26 18:41:45 realgeopolitics の産業政策インターフェースを拡張。CLI に `industry subsidize` を追加し、コアの `GameState` へ補助金適用 API を実装。Web 版には「産業」タブとセクター別スライダー＋棒／折れ線 KPI グラフを追加し、`C\\Users\\gomur\\.cargo\\bin\\cargo.exe test --workspace` と `C\\Users\\gomur\\.cargo\\bin\\cargo.exe build -p realgeopolitics-web --target wasm32-unknown-unknown` を実行して動作確認。
- 2025-09-26 19:01:16 realgeopolitics の責務分割提案を `realgeopolitics/ARCHITECTURE_SPLIT_PLAN.md` にまとめ、GameState/産業/イベント/CLI の分割方針と次アクションを整理。`TROUBLESHOOTING.md` に tick 順序の注意事項を追記。コード変更は行っていないためビルド実行は不要と判断。
- 2025-09-26 19:28:36 realgeopolitics-core に `game::bootstrap::GameBuilder` を追加し、国初期化・スケジューラ登録・イベントテンプレート読込を移譲。`GameState` は完成済み依存 (`GameBootstrap`) の受け取りに専念するよう再構成し、`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe build` の成功でビルドを確認。
- 2025-09-26 19:35:08 GameBuilder 向けユニットテストを追加し、定義未指定時のエラーと初期化依存が揃う正常系を検証。`C:\Users\gomur\.cargo\bin\cargo.exe fmt` と `C:\Users\gomur\.cargo\bin\cargo.exe test --workspace` が成功したことを確認。
